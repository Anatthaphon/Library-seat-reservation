<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weekly Calendar UI</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#64748b;
      /* thinner, more minimal grid lines */
      --line: rgba(148,163,184,.22);
      --accent:#2f7cff;
      --shadow: 0 10px 30px rgba(17,24,39,.08);

      /* layout */
      --hour-h: 68px;           /* height of 1 hour row */
      --time-col: 76px;         /* left time labels */
      --day-h: 54px;            /* day header height */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Thai", sans-serif;
      background: #0b0f17;
      color:var(--text);
      padding: 22px;
    }

    /* Desktop-fit canvas */
    .frame{
      width: min(1280px, calc(100vw - 44px));
      height: min(860px, calc(100vh - 44px));
      margin: 0 auto;
      background: var(--bg);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      border: 1px solid rgba(17,24,39,.06);
      display:flex;
      flex-direction:column;
    }

    /* Top bar */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 18px 18px 14px;
      gap: 14px;
      flex: 0 0 auto;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 14px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: #fff;
      color: var(--text);
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      user-select:none;
      transition: transform .05s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .btn:hover{border-color: rgba(148,163,184,.35); box-shadow:0 6px 14px rgba(17,24,39,.08)}
    .btn:active{transform: translateY(1px)}
    .btn:focus-visible,.iconbtn:focus-visible{outline: 3px solid rgba(47,124,255,.25); outline-offset: 2px}

    .nav{
      display:flex;
      align-items:center;
      gap: 12px;
      color: var(--text);
      font-weight: 800;
      min-width: 360px;
      justify-content:center;
    }

    .iconbtn{
      width: 40px;
      height: 40px;
      display:grid;
      place-items:center;
      border-radius: 999px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      transition: transform .05s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .iconbtn:hover{border-color: rgba(148,163,184,.35); box-shadow:0 6px 14px rgba(17,24,39,.08)}
    .iconbtn:active{transform: translateY(1px)}

    .range{
      min-width: 260px;
      text-align:center;
      font-weight: 800;
      color: #334155;
      letter-spacing:.2px;
    }

    .divider{
      height: 2px;
      background: var(--accent);
      opacity:.9;
      flex: 0 0 auto;
    }

    .calendar{
      padding: 12px 0 14px;
      flex: 1 1 auto;
      min-height: 0;
    }

    /* Weekly grid stays 7 days, but only 3 days are enabled (today..today+2) */
    .grid{
      height: 100%;
      display:grid;
      grid-template-columns: var(--time-col) repeat(7, 1fr);
      grid-template-rows: var(--day-h) repeat(8, var(--hour-h)); /* 09-16 */
      position: relative;
    }

    .dayhead{
      grid-row: 1;
      padding: 10px 8px;
      border-bottom: 1px solid var(--line);
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      cursor: pointer;
      user-select:none;
      transition: background .12s ease, color .12s ease;
    }
    .dayhead:hover{ background: rgba(241,245,249,.65); }

    .dayhead .dow{font-weight:800}
    .dayhead .date{font-weight: 900; color:#111827; opacity:.7;}

    .dayhead.today{ color:#0f172a; position:relative; }
    .dayhead.today::after{
      content:"";
      position:absolute;
      left: 14px;
      right: 14px;
      bottom: 7px;
      height: 3px;
      border-radius: 999px;
      background: rgba(47,124,255,.55);
    }

    .dayhead.selected{ background: rgba(47,124,255,.08); color:#0f172a; }

    .time{
      grid-column: 1;
      padding: 12px 10px;
      color: rgba(100,116,139,.95);
      font-weight: 900;
      font-size: 12px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      border-right: 1px solid var(--line);
      user-select:none;
    }

    .corner{
      grid-row:1;
      grid-column:1;
      border-right: 1px solid var(--line);
      border-bottom: 1px solid var(--line);
      background:#fff;
      position:relative;
    }
    .corner::after{
      content:"";
      position:absolute;
      left: 12px;
      top: 14px;
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 2px solid rgba(148,163,184,.55);
      box-shadow: inset 0 0 0 4px #fff;
    }

    .cell{
      border-bottom: 1px solid var(--line);
      border-right: 1px solid var(--line);
      background: #fff;
      cursor: pointer;
      position: relative;
      transition: background .12s ease;
    }
    .cell:hover{ background: rgba(241,245,249,.6); }
    .cell:focus-visible{ outline: 3px solid rgba(47,124,255,.25); outline-offset: -3px; z-index: 3; }
    .cell[disabled]{ cursor:not-allowed; opacity:.55; }

    /* Grey overlay for non-accessible days in the current view */
    .disabled-overlay{
      background: rgba(229,231,235,.9);
      pointer-events:none;
      z-index: 2;
      border-left: 1px solid var(--line);
    }

    .nowline{
      position:absolute;
      left: var(--time-col);
      right: 0;
      height: 2px;
      background: rgba(47,124,255,.55);
      z-index: 4;
      pointer-events:none;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(15,23,42,.92);
      color: #fff;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 700;
      box-shadow: 0 12px 28px rgba(0,0,0,.25);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-4px); }

    @media (max-width: 980px){
      body{padding:14px}
      .frame{width: calc(100vw - 28px); height: calc(100vh - 28px);}
      :root{ --hour-h: 60px; --time-col: 66px; }
      .nav{min-width: unset;}
      .range{min-width: 220px; font-size: 13px}
    }
    @media (max-width: 760px){
      :root{ --hour-h: 56px; --day-h: 46px; }
      .dayhead{font-size:11px}
      .range{display:none}
    }
  </style>
</head>
<body>
  <div class="frame">
    <div class="topbar">
      <button id="btnToday" class="btn" type="button" title="กลับไปสัปดาห์ปัจจุบัน (T)">Today</button>

      <div class="nav" aria-label="calendar navigation">
        <button id="btnPrev" class="iconbtn" type="button" aria-label="previous week" title="อาทิตย์ก่อนหน้า (←)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 19L8 12L15 5" stroke="#111827" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div id="rangeText" class="range">Loading…</div>
        <button id="btnNext" class="iconbtn" type="button" aria-label="next week" title="อาทิตย์ถัดไป (→)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 5L16 12L9 19" stroke="#111827" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <div style="width:84px"></div>
    </div>

    <div class="divider"></div>

    <div class="calendar">
      <div id="grid" class="grid" role="grid" aria-label="weekly calendar"></div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    const HOURS_START = 9;
    const HOURS_END = 16; // 09..16

    const DOW_EN = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    const gridEl = document.getElementById('grid');
    const rangeText = document.getElementById('rangeText');
    const toastEl = document.getElementById('toast');

    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    const btnToday = document.getElementById('btnToday');

    let weekStart = startOfWeek(new Date(), 1); // Monday start
    let selectedDayIndex = null;

    function startOfDay(date){
      const d = new Date(date);
      d.setHours(0,0,0,0);
      return d;
    }

    function dayKey(date){
      const d = startOfDay(date);
      return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    }

    function allowedDateSet(){
      // always: today..today+2
      const t0 = startOfDay(new Date());
      const set = new Set();
      for(let i=0;i<3;i++) set.add(dayKey(addDays(t0,i)));
      return set;
    }

    function startOfWeek(date, weekStartsOn = 1){
      const d = startOfDay(date);
      const day = d.getDay();
      const diff = (day - weekStartsOn + 7) % 7;
      d.setDate(d.getDate() - diff);
      return d;
    }

    function addDays(date, days){
      const d = new Date(date);
      d.setDate(d.getDate() + days);
      return d;
    }

    function formatRange(start){
      const end = addDays(start, 6);
      const optsA = { month: 'long', day: 'numeric' };
      const optsB = { month: 'long', day: 'numeric', year: 'numeric' };
      const a = start.toLocaleDateString(undefined, optsA);
      const b = end.toLocaleDateString(undefined, optsB);
      return `${a} – ${b}`;
    }

    function pad2(n){ return String(n).padStart(2,'0'); }

    function showToast(text){
      toastEl.textContent = text;
      toastEl.classList.add('show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toastEl.classList.remove('show'), 1400);
    }

    function sameDay(a,b){
      const da = startOfDay(a);
      const db = startOfDay(b);
      return da.getTime() === db.getTime();
    }

    function buildGrid(){
      gridEl.innerHTML = '';
      const allowed = allowedDateSet();
      const now = new Date();

      // Corner
      const corner = document.createElement('div');
      corner.className = 'corner';
      corner.setAttribute('aria-hidden','true');
      gridEl.appendChild(corner);

      // Headers
      for(let i=0;i<7;i++){
        const d = addDays(weekStart, i);
        const head = document.createElement('div');
        head.className = 'dayhead';
        head.style.gridColumn = String(2+i);
        head.tabIndex = 0;
        head.role = 'columnheader';

        if (sameDay(d, now)) head.classList.add('today');
        if (selectedDayIndex === i) head.classList.add('selected');

        head.innerHTML = `<span class="dow">${DOW_EN[d.getDay()]}</span><span class="date">${d.getDate()}</span>`;

        head.addEventListener('click', ()=>{
          selectedDayIndex = i;
          buildGrid();
        });
        head.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectedDayIndex = i;
            buildGrid();
          }
        });

        gridEl.appendChild(head);
      }

      // Time labels 09..16 (8 rows)
      for(let r=0; r<8; r++){
        const hour = HOURS_START + r;
        const t = document.createElement('div');
        t.className = 'time';
        t.style.gridRow = String(2 + r);
        t.textContent = pad2(hour);
        gridEl.appendChild(t);
      }

      // Cells
      for(let r=0; r<8; r++){
        const hour = HOURS_START + r;
        for(let c=0; c<7; c++){
          const dayDate = addDays(weekStart, c);
          const cell = document.createElement('button');
          cell.type = 'button';
          cell.className = 'cell';
          cell.style.gridRow = String(2 + r);
          cell.style.gridColumn = String(2 + c);

          // UX: if selected day, lightly shade other days
          if (selectedDayIndex !== null && selectedDayIndex !== c){
            cell.style.background = 'rgba(248,250,252,.45)';
          }

          const isAllowed = allowed.has(dayKey(dayDate));
          if(!isAllowed){
            cell.disabled = true;
          }

          const label = `${DOW_EN[dayDate.getDay()]} ${dayDate.toLocaleDateString()} ${pad2(hour)}:00`;
          cell.setAttribute('aria-label', label);

          cell.addEventListener('click', ()=>{
            const clicked = new Date(dayDate);
            clicked.setHours(hour,0,0,0);
            showToast(clicked.toLocaleString());
          });

          gridEl.appendChild(cell);
        }
      }

      rangeText.textContent = formatRange(weekStart);
      placeDisabledOverlays(allowed);
      placeNowLine();
    }

    function placeDisabledOverlays(allowed){
      gridEl.querySelectorAll('.disabled-overlay').forEach(n => n.remove());

      // Grey every column that is NOT in [today..today+2]
      for(let i=0;i<7;i++){
        const d = addDays(weekStart, i);
        if(allowed.has(dayKey(d))) continue;

        const overlay = document.createElement('div');
        overlay.className = 'disabled-overlay';
        overlay.style.gridColumn = String(2+i);
        overlay.style.gridRow = '2 / 10'; // rows 2..9
        gridEl.appendChild(overlay);
      }
    }

    function placeNowLine(){
      gridEl.querySelectorAll('.nowline').forEach(n => n.remove());

      const now = new Date();
      const t0 = startOfDay(now);

      // only draw if today is within the shown week
      const wk0 = startOfDay(weekStart);
      const wk6 = startOfDay(addDays(weekStart, 6));
      if(t0 < wk0 || t0 > wk6) return;

      const hr = now.getHours() + now.getMinutes()/60;
      if(hr < HOURS_START || hr > (HOURS_END + 1)) return;

      const offsetHours = hr - HOURS_START;
      const dayH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--day-h'));
      const hourH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--hour-h'));
      const y = dayH + Math.max(0, Math.min(offsetHours, 8)) * hourH;

      const line = document.createElement('div');
      line.className = 'nowline';
      line.style.top = `${y}px`;
      gridEl.appendChild(line);
    }

    function shiftWeek(deltaWeeks){
      weekStart = addDays(weekStart, 7 * deltaWeeks);
      selectedDayIndex = null;
      buildGrid();
    }

    btnPrev.addEventListener('click', ()=> shiftWeek(-1));
    btnNext.addEventListener('click', ()=> shiftWeek(1));
    btnToday.addEventListener('click', ()=>{
      weekStart = startOfWeek(new Date(), 1);
      selectedDayIndex = null;
      buildGrid();
      showToast('กลับมาวันนี้แล้ว');
    });

    window.addEventListener('keydown', (e)=>{
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
      if(tag === 'input' || tag === 'textarea') return;

      if(e.key === 'ArrowLeft') shiftWeek(-1);
      if(e.key === 'ArrowRight') shiftWeek(1);
      if(e.key.toLowerCase() === 't') btnToday.click();
    });

    // initial render
    buildGrid();

    // Auto-roll: if day changes, the enabled window (today..today+2) moves.
    // Also: if new day crosses into a new week, jump weekStart to the current week.
    let last = dayKey(new Date());
    setInterval(()=>{
      const cur = dayKey(new Date());
      if(cur !== last){
        last = cur;
        weekStart = startOfWeek(new Date(), 1);
        selectedDayIndex = null;
        buildGrid();
        showToast('วันใหม่แล้ว เลื่อนให้เอง');
      } else {
        placeNowLine();
      }
    }, 60_000);
  </script>
</body>
</html>